!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tslib"),require("fontfaceobserver-es")):"function"==typeof define&&define.amd?define(["exports","tslib","fontfaceobserver-es"],t):t((e=e||self).AsyncPreloader={},e.tslib,e.FontFaceObserver)}(this,function(e,i,r){"use strict";var o,t;(t=o=o||{}).Json="Json",t.ArrayBuffer="ArrayBuffer",t.Blob="Blob",t.FormData="FormData",t.Text="Text",t.Image="Image",t.Video="Video",t.Audio="Audio",t.Xml="Xml",t.Font="Font";var s=navigator&&-1<navigator.userAgent.indexOf("Safari"),n=(a.fetchItem=function(e){return fetch(e.src,e.options||{})},a.getProp=function(e,t){var n=Array.isArray(t)?t:t.split(".").filter(function(e){return e.length});return n.length?a.getProp(e[n.shift()],n):e},a.getFileExtension=function(e){return(e.match(/[^\\/]\.([^.\\/]+)$/)||[null]).pop()},a.getLoaderKey=function(t){var e=Array.from(a.loaders).find(function(e){return e[1].extensions.includes(t)});return e?e[0]:o.Text},a.getMimeType=function(e,t){var n=a.loaders.get(e);return n.mimeType[t]||n.defaultMimeType},a.loaders=(new Map).set(o.Text,{extensions:["txt"]}).set(o.Json,{extensions:["json"]}).set(o.Image,{extensions:["jpeg","jpg","gif","png","webp"]}).set(o.Video,{extensions:["webm","ogg","mp4"]}).set(o.Audio,{extensions:["webm","ogg","mp3","wav","flac"]}).set(o.Xml,{extensions:["xml","svg","html"],mimeType:{xml:"text/xml",svg:"image/svg+xml",html:"text/html"},defaultMimeType:"text/xml"}).set(o.Font,{extensions:["woff2","woff","ttf","otf","eot"]}),a.domParser=new DOMParser,a);function a(){var e=this;this.items=new Map,this.defaultBodyMethod="blob",this.defaultLoader=o.Text,this.loadItems=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(this.loadItem))];case 1:return[2,e.sent()]}})})},this.loadItem=function(r){return i.__awaiter(e,void 0,void 0,function(){var t,n;return i.__generator(this,function(e){switch(e.label){case 0:return t=a.getFileExtension(r.src),[4,this["load"+(r.loader||a.getLoaderKey(t))](r)];case 1:return n=e.sent(),this.items.set(r.id||r.src,n),[2,n]}})})},this.loadManifest=function(r,o){return void 0===o&&(o="items"),i.__awaiter(e,void 0,void 0,function(){var t,n;return i.__generator(this,function(e){switch(e.label){case 0:return[4,this.loadJson({src:r})];case 1:return t=e.sent(),n=a.getProp(t,o),[4,this.loadItems(n)];case 2:return[2,e.sent()]}})})},this.loadText=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent().text()];case 2:return[2,e.sent()]}})})},this.loadJson=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}})})},this.loadArrayBuffer=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent().arrayBuffer()];case 2:return[2,e.sent()]}})})},this.loadBlob=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()]}})})},this.loadFormData=function(t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent().formData()];case 2:return[2,e.sent()]}})})},this.loadImage=function(t){return i.__awaiter(e,void 0,void 0,function(){var r,o;return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent()[t.body||this.defaultBodyMethod]()];case 2:return(r=e.sent(),t.body)?[2,r]:(o=new Image,[4,new Promise(function(t,n){o.addEventListener("load",function e(){o.removeEventListener("load",e),t(o)}),o.addEventListener("error",function e(){o.removeEventListener("error",e),n(o)}),o.src=URL.createObjectURL(r)})]);case 3:return[2,e.sent()]}})})},this.loadVideo=function(t){return i.__awaiter(e,void 0,void 0,function(){var r,o;return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent()[t.body||this.defaultBodyMethod]()];case 2:return(r=e.sent(),t.body)?[2,r]:(o=document.createElement("video"),[4,new Promise(function(t,n){o.addEventListener("canplaythrough",function e(){o.removeEventListener("canplaythrough",e),t(o)}),o.addEventListener("error",function e(){o.removeEventListener("error",e),n(o)});try{if(s)throw"";o.srcObject=r}catch(e){o.src=URL.createObjectURL(r)}o.load()})]);case 3:return[2,e.sent()]}})})},this.loadAudio=function(t){return i.__awaiter(e,void 0,void 0,function(){var r,o;return i.__generator(this,function(e){switch(e.label){case 0:return[4,a.fetchItem(t)];case 1:return[4,e.sent()[t.body||this.defaultBodyMethod]()];case 2:return(r=e.sent(),t.body)?[2,r]:((o=document.createElement("audio")).autoplay=!1,o.preload="auto",[4,new Promise(function(t,n){o.addEventListener("canplaythrough",function e(){o.removeEventListener("canplaythrough",e),t(o)}),o.addEventListener("error",function e(){o.removeEventListener("error",e),n(o)});try{if(s)throw"";o.srcObject=r}catch(e){o.src=URL.createObjectURL(r)}o.load()})]);case 3:return[2,e.sent()]}})})},this.loadXml=function(r){return i.__awaiter(e,void 0,void 0,function(){var t,n;return i.__generator(this,function(e){switch(e.label){case 0:return r.mimeType||(t=a.getFileExtension(r.src),r=i.__assign(i.__assign({},r),{mimeType:a.getMimeType(o.Xml,t)})),[4,a.fetchItem(r)];case 1:return[4,e.sent().text()];case 2:return n=e.sent(),[2,a.domParser.parseFromString(n,r.mimeType)]}})})},this.loadFont=function(n){return i.__awaiter(e,void 0,void 0,function(){var t;return i.__generator(this,function(e){switch(e.label){case 0:return t=n.id,[4,new r(t,n.options||{}).load()];case 1:return e.sent(),[2,t]}})})}}var u=new n;e.AsyncPreloader=n,e.default=u,Object.defineProperty(e,"__esModule",{value:!0})});
